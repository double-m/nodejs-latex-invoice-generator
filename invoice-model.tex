\documentclass[a4paper]{report}

\usepackage[utf8]{inputenc}
\usepackage[italian]{babel}
\usepackage{/usr/share/texlive/texmf-dist/tex/latex/fancyhdr/fancyhdr}
\usepackage{lmodern,textcomp}
\usepackage{eurosym}
\usepackage{blindtext}
\usepackage[nomessages]{fp}
\usepackage{ifthen}
\usepackage{ragged2e}
\usepackage[]{geometry}

\input{./locales/italian.def}
\input{./values.def}

% Visual settings
\pagestyle{fancy}
\newgeometry{textwidth=400pt,marginparwidth=86pt,voffset=20pt}
\def \Spacer                             {10mm}
\linespread{1.5}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0.2pt}


% Default english expressions
\providecommand{\ClientHeading}          {Billed to}
\providecommand{\InvoiceNumberText}      {Invoice no.}
\providecommand{\VatName}                {VAT}

\providecommand{\HeadActivity}           {Activity}
\providecommand{\HeadAmount}             {Amount}
\providecommand{\FootTotal}              {Total}

% Default values
\providecommand{\MyName}                 {NAME SURNAME}
\providecommand{\MyAdress}               {ADDRESS}
\providecommand{\MyCity}                 {CITY, STATE}
\providecommand{\MyVat}                  {VAT\_CODE}
\providecommand{\MyContacts}             {MYSITE.COM}

\providecommand{\ClientName}             {COMPANY NAME}
\providecommand{\ClientAddress}          {ADDRESS}
\providecommand{\ClientCity}             {CITY, STATE}
\providecommand{\ClientVat}              {VAT\_CODE}

\providecommand{\InvoiceNumberValue}     {0}
\providecommand{\InvoiceDate}            {\today}

\providecommand{\ActivityDescription}    {\blindtext}
\providecommand{\ActivityFee}            {0.00}

\providecommand{\OptionalTaxDescription} {OPTIONAL TAX}
\providecommand{\OptionalTaxRate}        {10}

\providecommand{\Note}                   {}
\providecommand{\NoteTreshold}           {}

% Calculated values
\def \ClientVatOut                       {\VatName:\ \ClientVat}
\def \InvoiceNumberOut                   {\InvoiceNumberText\ \InvoiceNumberValue}
\def \OptionalTaxDescOut                 {\OptionalTaxDescription\ (\OptionalTaxRate\%)}
\FPeval{\OptionalTaxAmount}              {round(\ActivityFee * \OptionalTaxRate / 100, 2)}
\FPeval{\CalculatedTotal}                {round(\ActivityFee + \OptionalTaxAmount, 2)}

% Compose the header and the footer
\makeatletter

\lhead{}
\chead{\scshape\large \MyName}
\rhead{}

\lfoot{}
\cfoot{\scshape\footnotesize \ \\ \MyName, \MyAdress $-$ \MyCity, \VatName: \MyVat $-$ \MyContacts}
\rfoot{}

% Compose the body
\begin{document}

\ \vspace{\Spacer}

\begin{minipage}[t]{\textwidth}
  \begin{verse}
    \begin{flushright}
      \begin{tabular}{rl}
        \ClientHeading & \textbf{\ClientName}
        \\
        & \ClientAddress
        \\
        & \ClientCity
        \\
        & \ClientVatOut
      \end{tabular}
    \end{flushright}
  \end{verse}
\end{minipage}

\vspace{\Spacer}

\begin{minipage}[t]{\textwidth}
  \begin{flushleft}
    \begin{tabular}{r}
      \InvoiceNumberOut
      \\
      \InvoiceDate
    \end{tabular}
  \end{flushleft}
\end{minipage}

\vspace{\Spacer}

\noindent
\begin{tabular*}{\textwidth}{p{9cm} @{\extracolsep{\fill}} r}
  \textbf{\HeadActivity} & \textbf{\HeadAmount} \\
  \hline
  & \\

  {\setlength{\baselineskip}{0.7\baselineskip}
    \ActivityDescription \par
  }
  & \ActivityFee \texteuro

  \ifthenelse{\equal{\OptionalTaxRate}{0}}{\\}{
    \\
    {\setlength{\baselineskip}{0.7\baselineskip}
      \OptionalTaxDescOut \par
    }
    & \OptionalTaxAmount \texteuro
    \\
  }

  \hline
  \textbf{\FootTotal} & \textbf{\CalculatedTotal \texteuro}
\end{tabular*}

\vspace{\Spacer}

\ifthenelse{\equal{\Note}{}}{}{
  {\setlength{\baselineskip}{0.7\baselineskip}
    \noindent
    \Note
    \ifthenelse{\equal{\NoteTreshold}{}}
      {}
      {\FPeval{\tresh}{round(\CalculatedTotal * 100 - \Treshold * 100, 0)}
      \ifthenelse{\tresh>0}
        {\NoteTreshold}
        {}
      }
  \par}
}

% TODO line for the signature
%\vspace{\Spacer}

\end{document}

